<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#87CEEB" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.145.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Jenkins入门"><meta itemprop=description content="保持简单、易用、强大功能。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://szhiku.github.io/content/hugo_next_avatar.jpg"><meta itemprop=keywords content="运维,Linux,Jenkins"><meta property="og:type" content="article"><meta property="og:title" content="Jenkins入门"><meta property="og:description" content="保持简单、易用、强大功能。"><meta property="og:image" content="/content/hugo_next_avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://szhiku.github.io/post/jenkins-entry-z2edmed.html"><meta property="og:site_name" content="szhiku.cn"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="szh"><meta property="article:published_time" content="2024-03-05 12:32:45 +0000 UTC"><meta property="article:modified_time" content="2024-03-05 12:34:21 +0000 UTC"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.8ea0817a6402d7fa3cdf50485ca3517c0b0774c939d76b920490340debb3cd98.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"jenkins-entry-z2edmed.html","permalink":"https://szhiku.github.io/post/jenkins-entry-z2edmed.html","title":"Jenkins入门","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>Jenkins入门 - szhiku.cn</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>szhiku.cn</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>szh知识库</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>24</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#1官方网站>1.官方网站</a></li><li><a href=#2安装部署>2.安装部署</a></li><li><a href=#3目录文件说明>3.目录文件说明</a></li><li><a href=#4配置使用root账户运行>4.配置使用root账户运行</a></li><li><a href=#5启动jenkins>5.启动jenkins</a></li><li><a href=#6解锁jenkins>6.解锁Jenkins</a></li><li><a href=#7修改admin密码>7.修改admin密码</a></li><li><a href=#8使用清华源作为插件地址>8.使用清华源作为插件地址</a></li><li><a href=#9使用离线安装插件>9.使用离线安装插件</a></li></ul><ul><li><a href=#1创建新任务>1.创建新任务</a></li><li><a href=#2添加构建步骤>2.添加构建步骤</a></li><li><a href=#3点击立即构建>3.点击立即构建</a></li><li><a href=#4查看控制台输出>4.查看控制台输出</a></li></ul><ul><li><a href=#1gitlab导入工程>1.gitlab导入工程</a></li><li><a href=#2在jenkins中关联gitlab的h5game项目>2.在jenkins中关联gitlab的h5game项目</a><ul><li><a href=#21-创建新项目>2.1 创建新项目</a></li><li><a href=#22-填写仓库地址>2.2 填写仓库地址</a></li></ul></li><li><a href=#3配置jenkins访问gitlab的权限>3.配置jenkins访问gitlab的权限</a><ul><li><a href=#31-部署公钥解释和步骤>3.1 部署公钥解释和步骤</a></li><li><a href=#32-获取jenkins服务器的ssh公钥信息>3.2 获取jenkins服务器的SSH公钥信息</a></li><li><a href=#33-gitlab添加部署公钥>3.3 gitlab添加部署公钥</a></li><li><a href=#34-gitlab项目关联部署公钥>3.4 gitlab项目关联部署公钥</a></li><li><a href=#35-jenkins配置私钥凭证>3.5 jenkins配置私钥凭证</a></li><li><a href=#36-测试获取代码>3.6 测试获取代码</a></li></ul></li><li><a href=#4编写部署脚本>4.编写部署脚本</a></li><li><a href=#4jenkins调用构建脚本>4.jenkins调用构建脚本</a></li></ul><ul><li><a href=#1jenkins项目里添加构建触发器>1.jenkins项目里添加构建触发器</a></li><li><a href=#2gitlab添加webhook>2.gitlab添加webhook</a></li></ul><ul><li><a href=#1gitlab生成access-token>1.gitlab生成access token</a></li><li><a href=#2jenkins配置gitlab的token>2.jenkins配置gitlab的token</a></li><li><a href=#3设置项目构建后将结果通知给gitlab>3.设置项目构建后将结果通知给gitlab</a></li><li><a href=#4合并分支然后检查gitlab能否收到消息>4.合并分支然后检查gitlab能否收到消息</a></li><li><a href=#5防止重复构建>5.防止重复构建</a></li></ul><ul><li><a href=#1给代码打标签>1.给代码打标签</a></li><li><a href=#2gitlab查看标签>2.gitlab查看标签</a></li><li><a href=#3jenkins配置参数化构建>3.jenkins配置参数化构建</a></li><li><a href=#4优化部署脚本>4.优化部署脚本</a></li><li><a href=#5jenkins添加执行脚本动作并测试>5.jenkins添加执行脚本动作并测试</a></li><li><a href=#6测试发布>6.测试发布</a></li></ul><ul><li><a href=#1jenkins配置回滚选项参数>1.jenkins配置回滚选项参数</a></li><li><a href=#2修改发布脚本增加条件判断>2.修改发布脚本增加条件判断</a></li><li><a href=#3测试回滚功能>3.测试回滚功能</a></li><li><a href=#4发布新代码并打标签测试>4.发布新代码并打标签测试</a></li></ul><ul><li><a href=#1jenkins新建打标签工程>1.jenkins新建打标签工程</a></li><li><a href=#2配置参数化构建>2.配置参数化构建</a></li><li><a href=#3配置工程的源码管理>3.配置工程的源码管理</a></li><li><a href=#4配置构建动作>4.配置构建动作</a></li><li><a href=#5发布新版本并提交到master>5.发布新版本并提交到master</a></li><li><a href=#6jenkins使用打标签工程来打标签>6.jenkins使用打标签工程来打标签</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=szh src=/imgs/img-lazy-loading.gif data-src=/content/hugo_next_avatar.jpg><p class=site-author-name itemprop=name>szh</p><div class=site-description itemprop=description>保持简单、易用、强大功能。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>24</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>3</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>15</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/szhiku title="Github → https://github.com/szhiku" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=aaa467843177@qq.com title="E-Mail → aaa467843177@qq.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/feng-ying-xia-3 title="知乎 → https://www.zhihu.com/people/feng-ying-xia-3" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2022-06-08T21:12:52+08:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=85845></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=183></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2025-03-17T06:44:32+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/hugo-next rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://szhiku.github.io/post/jenkins-entry-z2edmed.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/content/hugo_next_avatar.jpg"><meta itemprop=name content="szh"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="szh"><meta itemprop=description content="保持简单、易用、强大功能。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Jenkins入门"><meta itemprop=description content='Jenkins入门

第0章 Jenkins介绍

1.jenkins是一个开源的持续集成工具，由java语言开发
2.jenkins是一个调度平台，拥有众多的插件，绝大部分功能都是由插件来完成的
第1章 Jenkins安装

1.官方网站

https://www.jenkins.io/zh/
https://www.jenkins.io/zh/doc/
2.安装部署

　　清华源直接下载rpm包安装即可,下载地址如下：
https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat/
　　安装命令如下：
rpm -ivh jdk-8u181-linux-x64.rpm 
rpm -ivh jenkins-2.176.1-1.1.noarch.rpm 
3.目录文件说明

[root@jenkins ~]# rpm -ql jenkins 
/etc/init.d/jenkins                         #启动文件
/etc/logrotate.d/jenkins                #日志切割脚本
/etc/sysconfig/jenkins                  #配置文件
/usr/lib/jenkins                                #安装目录
/usr/lib/jenkins/jenkins.war        #安装包
/usr/sbin/rcjenkins                     
/var/cache/jenkins                      
/var/lib/jenkins                                #数据目录
/var/log/jenkins                                #日志目录
4.配置使用root账户运行

vim /etc/sysconfig/jenkins
JENKINS_USER="root"
5.启动jenkins

systemctl start jenkins
6.解锁Jenkins

　　​​'></span><header class=post-header><h1 class=post-title itemprop="name headline">Jenkins入门</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2024-03-05 12:32:45 +0000 UTC" itemprop="dateCreated datePublished" datetime="2024-03-05 12:32:45 +0000 UTC">2024-03-05
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title=修改时间：2024-03-05T12:34:21+00:00 itemprop=dateModified datetime=2024-03-05T12:34:21+00:00>2024-03-05</time>
</span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E6%8A%80%E6%9C%AF itemprop=url rel=index><span itemprop=name>技术</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>3710</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>8分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/jenkins-entry-z2edmed.html><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h1 id=jenkins入门>Jenkins入门
<a class=header-anchor href=#jenkins%e5%85%a5%e9%97%a8></a></h1><h1 id=第0章-jenkins介绍>第0章 Jenkins介绍
<a class=header-anchor href=#%e7%ac%ac0%e7%ab%a0-jenkins%e4%bb%8b%e7%bb%8d></a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>1</span>.<span style=color:#a6e22e>jenkins是一个开源的持续集成工具</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#f92672>由java语言开发</span>
</span></span><span style=display:flex><span><span style=color:#f92672>2</span>.<span style=color:#a6e22e>jenkins是一个调度平台</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#f92672>拥有众多的插件</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#f92672>绝大部分功能都是由插件来完成的</span>
</span></span></code></pre></div><h1 id=第1章-jenkins安装>第1章 Jenkins安装
<a class=header-anchor href=#%e7%ac%ac1%e7%ab%a0-jenkins%e5%ae%89%e8%a3%85></a></h1><h2 id=1官方网站>1.官方网站
<a class=header-anchor href=#1%e5%ae%98%e6%96%b9%e7%bd%91%e7%ab%99></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span>https:<span style=color:#75715e>//www.jenkins.io/zh/
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>https:<span style=color:#75715e>//www.jenkins.io/zh/doc/
</span></span></span></code></pre></div><h2 id=2安装部署>2.安装部署
<a class=header-anchor href=#2%e5%ae%89%e8%a3%85%e9%83%a8%e7%bd%b2></a></h2><p>　　清华源直接下载rpm包安装即可,下载地址如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#e6db74>https</span>:<span style=color:#e6db74>//mi</span>rrors<span style=color:#f92672>.</span>tuna<span style=color:#f92672>.</span>tsinghua<span style=color:#f92672>.</span>edu<span style=color:#f92672>.</span>cn<span style=color:#f92672>/</span>jenkins<span style=color:#f92672>/</span>redhat<span style=color:#f92672>/</span>
</span></span></code></pre></div><p>　　安装命令如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>rpm</span> <span style=color:#f92672>-ivh</span> <span style=color:#f92672>jdk-8u181-linux-x64</span>.<span style=color:#a6e22e>rpm</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>rpm</span> <span style=color:#f92672>-ivh</span> <span style=color:#f92672>jenkins-2</span>.<span style=color:#a6e22e>176</span>.<span style=color:#a6e22e>1-1</span>.<span style=color:#a6e22e>1</span>.<span style=color:#a6e22e>noarch</span>.<span style=color:#a6e22e>rpm</span> 
</span></span></code></pre></div><h2 id=3目录文件说明>3.目录文件说明
<a class=header-anchor href=#3%e7%9b%ae%e5%bd%95%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8e></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[root@jenkins ~]</span><span style=color:#960050;background-color:#1e0010>#</span> rpm -ql jenkins 
</span></span><span style=display:flex><span>/etc/<span style=color:#66d9ef>init</span>.d/jenkins                         <span style=color:#960050;background-color:#1e0010>#启动文件</span>
</span></span><span style=display:flex><span>/etc/logrotate.d/jenkins                <span style=color:#960050;background-color:#1e0010>#日志切割脚本</span>
</span></span><span style=display:flex><span>/etc/sysconfig/jenkins                  <span style=color:#960050;background-color:#1e0010>#配置文件</span>
</span></span><span style=display:flex><span>/usr/lib/jenkins                                <span style=color:#960050;background-color:#1e0010>#安装目录</span>
</span></span><span style=display:flex><span>/usr/lib/jenkins/jenkins.war        <span style=color:#960050;background-color:#1e0010>#安装包</span>
</span></span><span style=display:flex><span>/usr/sbin/rcjenkins                     
</span></span><span style=display:flex><span>/<span style=color:#66d9ef>var</span>/cache/jenkins                      
</span></span><span style=display:flex><span>/<span style=color:#66d9ef>var</span>/lib/jenkins                                <span style=color:#960050;background-color:#1e0010>#数据目录</span>
</span></span><span style=display:flex><span>/<span style=color:#66d9ef>var</span>/log/jenkins                                <span style=color:#960050;background-color:#1e0010>#日志目录</span>
</span></span></code></pre></div><h2 id=4配置使用root账户运行>4.配置使用root账户运行
<a class=header-anchor href=#4%e9%85%8d%e7%bd%ae%e4%bd%bf%e7%94%a8root%e8%b4%a6%e6%88%b7%e8%bf%90%e8%a1%8c></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/sysconfig/jenkins
</span></span><span style=display:flex><span>JENKINS_USER<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;root&#34;</span>
</span></span></code></pre></div><h2 id=5启动jenkins>5.启动jenkins
<a class=header-anchor href=#5%e5%90%af%e5%8a%a8jenkins></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>systemctl start jenkins
</span></span></code></pre></div><h2 id=6解锁jenkins>6.解锁Jenkins
<a class=header-anchor href=#6%e8%a7%a3%e9%94%81jenkins></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-f8377d8d5e65bca3.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=7修改admin密码>7.修改admin密码
<a class=header-anchor href=#7%e4%bf%ae%e6%94%b9admin%e5%af%86%e7%a0%81></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-029c4923840f031f.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=8使用清华源作为插件地址>8.使用清华源作为插件地址
<a class=header-anchor href=#8%e4%bd%bf%e7%94%a8%e6%b8%85%e5%8d%8e%e6%ba%90%e4%bd%9c%e4%b8%ba%e6%8f%92%e4%bb%b6%e5%9c%b0%e5%9d%80></a></h2><p>　　清华源地址：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#e6db74>https</span>:<span style=color:#e6db74>//mi</span>rrors<span style=color:#f92672>.</span>tuna<span style=color:#f92672>.</span>tsinghua<span style=color:#f92672>.</span>edu<span style=color:#f92672>.</span>cn<span style=color:#f92672>/</span>jenkins<span style=color:#f92672>/</span>updates<span style=color:#f92672>/</span>update<span style=color:#f92672>-</span>center<span style=color:#f92672>.</span>json
</span></span></code></pre></div><p>　　配置步骤：</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-8d1e28f31d72f26d.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/640/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-06f7ea12c181ebd7.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-93f127f665a19e60.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-d7e4774e660ac4c6.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=9使用离线安装插件>9.使用离线安装插件
<a class=header-anchor href=#9%e4%bd%bf%e7%94%a8%e7%a6%bb%e7%ba%bf%e5%ae%89%e8%a3%85%e6%8f%92%e4%bb%b6></a></h2><p>　　我们可以将插件提前下好，然后只需要解压到jenkins对应的目录即可</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span>tar zxf jenkins_plugins.tar.gz -C /<span style=color:#66d9ef>var</span>/lib/jenkins/
</span></span><span style=display:flex><span>ll /<span style=color:#66d9ef>var</span>/lib/jenkins/plugins/
</span></span></code></pre></div><p>　　重启jenkins：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>systemctl restart jenkins
</span></span></code></pre></div><h1 id=第2章-构建自由风格的项目>第2章 构建自由风格的项目
<a class=header-anchor href=#%e7%ac%ac2%e7%ab%a0-%e6%9e%84%e5%bb%ba%e8%87%aa%e7%94%b1%e9%a3%8e%e6%a0%bc%e7%9a%84%e9%a1%b9%e7%9b%ae></a></h1><h2 id=1创建新任务>1.创建新任务
<a class=header-anchor href=#1%e5%88%9b%e5%bb%ba%e6%96%b0%e4%bb%bb%e5%8a%a1></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-ed796fd4c6731efd.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-16d0fb9d088a29dc.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-04f8873f53b2706a.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=2添加构建步骤>2.添加构建步骤
<a class=header-anchor href=#2%e6%b7%bb%e5%8a%a0%e6%9e%84%e5%bb%ba%e6%ad%a5%e9%aa%a4></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-bc678db89fcde269.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/678/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-068ac56f2e216e3c.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=3点击立即构建>3.点击立即构建
<a class=header-anchor href=#3%e7%82%b9%e5%87%bb%e7%ab%8b%e5%8d%b3%e6%9e%84%e5%bb%ba></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-419a3587730ecb19.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=4查看控制台输出>4.查看控制台输出
<a class=header-anchor href=#4%e6%9f%a5%e7%9c%8b%e6%8e%a7%e5%88%b6%e5%8f%b0%e8%be%93%e5%87%ba></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-ffb395226b5d7609.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/594/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-e5071f2a2003d5ec.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h1 id=第3章-发布gitlab中的静态项目>第3章 发布gitlab中的静态项目
<a class=header-anchor href=#%e7%ac%ac3%e7%ab%a0-%e5%8f%91%e5%b8%83gitlab%e4%b8%ad%e7%9a%84%e9%9d%99%e6%80%81%e9%a1%b9%e7%9b%ae></a></h1><h2 id=1gitlab导入工程>1.gitlab导入工程
<a class=header-anchor href=#1gitlab%e5%af%bc%e5%85%a5%e5%b7%a5%e7%a8%8b></a></h2><p>　　这是一个h5小游戏的项目，项目地址：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span>https:<span style=color:#75715e>//gitee.com/skips/game.git
</span></span></span></code></pre></div><p>　　使用gitlab直接导入项目：</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-440b7c4b826702b3.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-7578543bc750c1e9.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-55a56065bbdd8af0.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-38ed2676c80fe7e3.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-468ae64cb8f93e3f.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=2在jenkins中关联gitlab的h5game项目>2.在jenkins中关联gitlab的h5game项目
<a class=header-anchor href=#2%e5%9c%a8jenkins%e4%b8%ad%e5%85%b3%e8%81%94gitlab%e7%9a%84h5game%e9%a1%b9%e7%9b%ae></a></h2><h3 id=21-创建新项目>2.1 创建新项目
<a class=header-anchor href=#21-%e5%88%9b%e5%bb%ba%e6%96%b0%e9%a1%b9%e7%9b%ae></a></h3><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-cc6f8da51bb49d59.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-1ccf61fff7ea7545.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h3 id=22-填写仓库地址>2.2 填写仓库地址
<a class=header-anchor href=#22-%e5%a1%ab%e5%86%99%e4%bb%93%e5%ba%93%e5%9c%b0%e5%9d%80></a></h3><p>　　选择源码管理，然后填写gitlab仓库信息，但是我们发现报错了，因为jenkins没有拉取gitlab项目的权限。</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-7fba0e0ea61640cb.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=3配置jenkins访问gitlab的权限>3.配置jenkins访问gitlab的权限
<a class=header-anchor href=#3%e9%85%8d%e7%bd%aejenkins%e8%ae%bf%e9%97%aegitlab%e7%9a%84%e6%9d%83%e9%99%90></a></h2><h3 id=31-部署公钥解释和步骤>3.1 部署公钥解释和步骤
<a class=header-anchor href=#31-%e9%83%a8%e7%bd%b2%e5%85%ac%e9%92%a5%e8%a7%a3%e9%87%8a%e5%92%8c%e6%ad%a5%e9%aa%a4></a></h3><p>　　解释</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>1</span>.<span style=color:#a6e22e>如果我们想让jenkins从gitlab上拉取代码</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#f92672>那么需要将jenkins的公钥信息放在gitlab上</span><span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span><span style=color:#f92672>2</span>.<span style=color:#a6e22e>gitlab针对这种情况有一个专门的功能</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#f92672>叫做部署部署公钥</span><span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span><span style=color:#f92672>3</span>.<span style=color:#a6e22e>部署公钥的作用是不需要创建虚拟用户和组</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#f92672>直接在需要拉取的项目里关联部署公钥即可</span><span style=color:#960050;background-color:#1e0010>。</span>
</span></span></code></pre></div><p>　　步骤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>1</span>.<span style=color:#a6e22e>获取jenkins公钥信息</span>
</span></span><span style=display:flex><span><span style=color:#f92672>2</span>.<span style=color:#a6e22e>将jenkins公钥信息填写到gitlab的部署公钥里</span>
</span></span><span style=display:flex><span><span style=color:#f92672>3</span>.<span style=color:#a6e22e>由项目管理员操作</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#f92672>在需要jenkins拉取的项目里关联部署公钥</span>
</span></span><span style=display:flex><span><span style=color:#f92672>4</span>.<span style=color:#a6e22e>jenkins配置私钥凭证</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#f92672>部署项目时关联凭证</span>
</span></span></code></pre></div><h3 id=32-获取jenkins服务器的ssh公钥信息>3.2 获取jenkins服务器的SSH公钥信息
<a class=header-anchor href=#32-%e8%8e%b7%e5%8f%96jenkins%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%9a%84ssh%e5%85%ac%e9%92%a5%e4%bf%a1%e6%81%af></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#f92672>[</span>root@jenkins<span style=color:#f92672>-</span><span style=color:#ae81ff>201</span> <span style=color:#f92672>~]</span><span style=color:#75715e># cat .ssh/id_rsa.pub </span>
</span></span><span style=display:flex><span>ssh<span style=color:#f92672>-</span>rsa <span style=color:#66d9ef>AAAAB3NzaC1yc2EAAAADAQABAAABAQCg8</span><span style=color:#f92672>+</span><span style=color:#66d9ef>DQFOjR</span><span style=color:#f92672>+</span>gl1Xw83CIyGJ50vI4DBeTaMRFdu5<span style=color:#f92672>+</span><span style=color:#ae81ff>5</span>pT<span style=color:#f92672>/</span><span style=color:#66d9ef>IMnYq1iS7</span><span style=color:#f92672>/</span>lRS6JxXLYvVeNMDUfDxA1sOL70okyA3npjASXgJPGE1FsbpqzWjsN0TAGoZkR1VWuP9Yn0CrH7dA4lhZQfUUVjvqzFBZK8N9iZMzIu6KOiSY<span style=color:#f92672>/</span>aD4Ol59vbDS4kO0rTG1DYQNnjZzMPNlIiJ<span style=color:#f92672>+</span><span style=color:#ae81ff>0</span><span style=color:#66d9ef>EVkfuYRwABRFA8fmL</span><span style=color:#f92672>+</span><span style=color:#ae81ff>6</span>btqZqhjGY29EHuIfzIMTDTysrtCTGxQn2ql1zwjReGiNXzmFncwvyy92DAuMbnOQiE1YNn72wThy2oWSHsCwKdIvcNHqY2xBvFnkZ9Ltga7PgR33kbJ7Gl8tjiZF root@jenkins<span style=color:#f92672>-</span><span style=color:#ae81ff>201</span>
</span></span></code></pre></div><h3 id=33-gitlab添加部署公钥>3.3 gitlab添加部署公钥
<a class=header-anchor href=#33-gitlab%e6%b7%bb%e5%8a%a0%e9%83%a8%e7%bd%b2%e5%85%ac%e9%92%a5></a></h3><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-8245335176b870e6.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-911c35751356101b.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-a15072f418867524.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h3 id=34-gitlab项目关联部署公钥>3.4 gitlab项目关联部署公钥
<a class=header-anchor href=#34-gitlab%e9%a1%b9%e7%9b%ae%e5%85%b3%e8%81%94%e9%83%a8%e7%bd%b2%e5%85%ac%e9%92%a5></a></h3><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-923c0626e97cac54.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-269984bc18f7b63c.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-295d87972e0f87d0.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h3 id=35-jenkins配置私钥凭证>3.5 jenkins配置私钥凭证
<a class=header-anchor href=#35-jenkins%e9%85%8d%e7%bd%ae%e7%a7%81%e9%92%a5%e5%87%ad%e8%af%81></a></h3><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-be5e1d77e73b1f78.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-5ed3036f123ac2d8.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-f2583b5486ae0c9d.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h3 id=36-测试获取代码>3.6 测试获取代码
<a class=header-anchor href=#36-%e6%b5%8b%e8%af%95%e8%8e%b7%e5%8f%96%e4%bb%a3%e7%a0%81></a></h3><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-4714f458d20d2ea1.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-505097d0d0014a40.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/690/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-d14c12d0768d5a49.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　查看拉取的代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[root@jenkins-201 ~]</span><span style=color:#960050;background-color:#1e0010>#</span> ll /<span style=color:#66d9ef>var</span>/lib/jenkins/workspace/h5game
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>总用量</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>4</span> jenkins jenkins   <span style=color:#ae81ff>47</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>37</span> game
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> jenkins jenkins <span style=color:#ae81ff>9349</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>37</span> LICENSE
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> jenkins jenkins  <span style=color:#ae81ff>937</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>37</span> README.md
</span></span></code></pre></div><h2 id=4编写部署脚本>4.编写部署脚本
<a class=header-anchor href=#4%e7%bc%96%e5%86%99%e9%83%a8%e7%bd%b2%e8%84%9a%e6%9c%ac></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#创建目录</span>
</span></span><span style=display:flex><span>mkdir -p /scripts/jenkins/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#编写脚本</span>
</span></span><span style=display:flex><span>cat &gt; /scripts/jenkins/deploy.sh <span style=color:#e6db74>&lt;&lt; &#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>PATH_CODE=/var/lib/jenkins/workspace/h5game/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>PATH_WEB=/usr/share/nginx
</span></span></span><span style=display:flex><span><span style=color:#e6db74>TIME=$(date +%Y%m%d-%H%M)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>IP=10.0.0.7
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#打包代码
</span></span></span><span style=display:flex><span><span style=color:#e6db74>cd ${PATH_CODE} 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tar zcf /opt/${TIME}-web.tar.gz ./*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#拷贝打包好的代码发送到web服务器代码目录
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ssh ${IP} &#34;mkdir ${PATH_WEB}/${TIME}-web -p&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>scp /opt/${TIME}-web.tar.gz ${IP}:${PATH_WEB}/${TIME}-web
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#web服务器解压代码
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ssh ${IP} &#34;cd ${PATH_WEB}/${TIME}-web &amp;&amp; tar xf ${TIME}-web.tar.gz &amp;&amp; rm -rf ${TIME}-web.tar.gz&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ssh ${IP} &#34;cd ${PATH_WEB} &amp;&amp; rm -rf html &amp;&amp; ln -s ${TIME}-web html&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#添加可执行权限</span>
</span></span><span style=display:flex><span>chmod +x /scripts/jenkins/deploy.sh
</span></span></code></pre></div><p>　　也可以使用jenkins内置的变量来代替自定义变量，查看jenkins内置变量的地址如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span>http:<span style=color:#75715e>//10.0.0.201:8080/env-vars.html
</span></span></span></code></pre></div><h2 id=4jenkins调用构建脚本>4.jenkins调用构建脚本
<a class=header-anchor href=#4jenkins%e8%b0%83%e7%94%a8%e6%9e%84%e5%bb%ba%e8%84%9a%e6%9c%ac></a></h2><p>　　在构建的位置填写执行shell脚本的命令</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-4213a8e519fbafe2.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　然后立即构建，发现报错了，提示权限不足：</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-8802e9763ff10980.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　报错原因是因为jenkins是以jenkins用户运行的，所以提示权限不足，我们可以修改jenkins为root用户运行。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[root@jenkins-201 ~]</span><span style=color:#960050;background-color:#1e0010>#</span> vim /etc/sysconfig/jenkins 
</span></span><span style=display:flex><span><span style=color:#a6e22e>[root@jenkins-201 ~]</span><span style=color:#960050;background-color:#1e0010>#</span> grep <span style=color:#e6db74>&#34;USER&#34;</span> /etc/sysconfig/jenkins 
</span></span><span style=display:flex><span>JENKINS_USER=<span style=color:#e6db74>&#34;root&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>[root@jenkins-201 ~]</span><span style=color:#960050;background-color:#1e0010>#</span> systemctl restart jenkins
</span></span></code></pre></div><p>　　重启好之后我们重新构建一下：</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-0d66ead3b64b327b.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　查看一下web服务器的代码目录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[root@web-7 ~]</span><span style=color:#960050;background-color:#1e0010>#</span> ll /usr/share/nginx/
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>总用量</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>13</span> <span style=color:#ae81ff>20200806</span>-<span style=color:#ae81ff>1013</span>-web
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>13</span> html -&gt; <span style=color:#ae81ff>20200806</span>-<span style=color:#ae81ff>1013</span>-web
</span></span></code></pre></div><h1 id=第4章-监听gitlab自动触发构建>第4章 监听gitlab自动触发构建
<a class=header-anchor href=#%e7%ac%ac4%e7%ab%a0-%e7%9b%91%e5%90%acgitlab%e8%87%aa%e5%8a%a8%e8%a7%a6%e5%8f%91%e6%9e%84%e5%bb%ba></a></h1><h2 id=1jenkins项目里添加构建触发器>1.jenkins项目里添加构建触发器
<a class=header-anchor href=#1jenkins%e9%a1%b9%e7%9b%ae%e9%87%8c%e6%b7%bb%e5%8a%a0%e6%9e%84%e5%bb%ba%e8%a7%a6%e5%8f%91%e5%99%a8></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-728449bb72b3352f.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=2gitlab添加webhook>2.gitlab添加webhook
<a class=header-anchor href=#2gitlab%e6%b7%bb%e5%8a%a0webhook></a></h2><p>　　将刚才jenkins里配置的token和URL地址复制进去</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-c009f8dedb04f9d4.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　较新版本的gitlab此时点击添加会提示报错：</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-d698109232b97afd.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　解决方法：进入admin area区域，然后点击setting&ndash;>network进行设置</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-909c35138faab3bd.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　正常添加成功之后，会在下方出现测试的选项</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-e8a0a5b65af14e9d.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　选择push事件来测试是否可以正常出发，如果可以，会在页面上方显示200状态码</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-ac106fe6813583ec.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/726/format/webp alt>​</p><p>　　此时我们去查看jenkins项目页面，就会发现以及出发了来自gitlab的构建任务</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-5fee98a1052e320e.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h1 id=第5章-返回构建状态给gitlab>第5章 返回构建状态给gitlab
<a class=header-anchor href=#%e7%ac%ac5%e7%ab%a0-%e8%bf%94%e5%9b%9e%e6%9e%84%e5%bb%ba%e7%8a%b6%e6%80%81%e7%bb%99gitlab></a></h1><h2 id=1gitlab生成access-token>1.gitlab生成access token
<a class=header-anchor href=#1gitlab%e7%94%9f%e6%88%90access-token></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-a764ae4dacddafcc.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　点击创建之后会生成一串token,注意及时保存，因为刷新就没有了</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-7a92c08e19cebc72.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=2jenkins配置gitlab的token>2.jenkins配置gitlab的token
<a class=header-anchor href=#2jenkins%e9%85%8d%e7%bd%aegitlab%e7%9a%84token></a></h2><p>　　点击jenkins的系统管理&ndash;>系统设置，然后找到gitlab选项</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-a9151d975fb91b50.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　填写gitlab的信息：</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-82b90e6c5901eadf.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　点击添加后返回上一层页面，然后选中刚才添加的gitlab凭证</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-d1a197f4b240325e.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=3设置项目构建后将结果通知给gitlab>3.设置项目构建后将结果通知给gitlab
<a class=header-anchor href=#3%e8%ae%be%e7%bd%ae%e9%a1%b9%e7%9b%ae%e6%9e%84%e5%bb%ba%e5%90%8e%e5%b0%86%e7%bb%93%e6%9e%9c%e9%80%9a%e7%9f%a5%e7%bb%99gitlab></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-6b6bda4a7153b110.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=4合并分支然后检查gitlab能否收到消息>4.合并分支然后检查gitlab能否收到消息
<a class=header-anchor href=#4%e5%90%88%e5%b9%b6%e5%88%86%e6%94%af%e7%84%b6%e5%90%8e%e6%a3%80%e6%9f%a5gitlab%e8%83%bd%e5%90%a6%e6%94%b6%e5%88%b0%e6%b6%88%e6%81%af></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-c7d923d1edfcc146.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=5防止重复构建>5.防止重复构建
<a class=header-anchor href=#5%e9%98%b2%e6%ad%a2%e9%87%8d%e5%a4%8d%e6%9e%84%e5%bb%ba></a></h2><p>　　jenkins具有很多内置变量，点击项目&ndash;>构建&ndash;> 查看 可用的环境变量列表</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span>http:<span style=color:#75715e>//10.0.0.201:8080/env-vars.html/
</span></span></span></code></pre></div><p>　　这里我们使用两个变量，一个是此次提交的commit的hash，另一个是上一次提交成功的commit的hash</p><p>　　我们可以在部署脚本里添加一行判断，如果这两个变量一样，那么就不用再次提交了</p><p>　　这些变量不需要在脚本里定义，直接引用即可</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-ae7d6674496200fe.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h1 id=第6章-tag方式发布版本>第6章 tag方式发布版本
<a class=header-anchor href=#%e7%ac%ac6%e7%ab%a0-tag%e6%96%b9%e5%bc%8f%e5%8f%91%e5%b8%83%e7%89%88%e6%9c%ac></a></h1><h2 id=1给代码打标签>1.给代码打标签
<a class=header-anchor href=#1%e7%bb%99%e4%bb%a3%e7%a0%81%e6%89%93%e6%a0%87%e7%ad%be></a></h2><p>　　首先我们先给代码打上标签，然后提交2个版本</p><p>　　v1.0版本：修改代码，然后发布v1.0版本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>git commit -am <span style=color:#e6db74>&#39;v1.0&#39;</span>
</span></span><span style=display:flex><span>git tag -a v1.0 -m <span style=color:#e6db74>&#34;v1.0 稳定版&#34;</span>
</span></span><span style=display:flex><span>git push -u origin v1.0
</span></span><span style=display:flex><span>git tag
</span></span></code></pre></div><p>　　v2.0版本：修改代码，然后发布v2.0版本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>git commit -am <span style=color:#e6db74>&#39;v2.0&#39;</span>
</span></span><span style=display:flex><span>git tag -a v2.0 -m <span style=color:#e6db74>&#34;v2.0 稳定版&#34;</span>
</span></span><span style=display:flex><span>git push -u origin v2.0
</span></span><span style=display:flex><span>git tag
</span></span></code></pre></div><h2 id=2gitlab查看标签>2.gitlab查看标签
<a class=header-anchor href=#2gitlab%e6%9f%a5%e7%9c%8b%e6%a0%87%e7%ad%be></a></h2><p>　　此时gitlab上可以看到2个标签</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-8b64cc7a62c08e76.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　点进去之后可以看到具体标签名称</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-4674a81262ed034b.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=3jenkins配置参数化构建>3.jenkins配置参数化构建
<a class=header-anchor href=#3jenkins%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0%e5%8c%96%e6%9e%84%e5%bb%ba></a></h2><p>　　jenkins上我们新建一个参数化构建项目</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-1443f148892eb0da.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　然后配置git的标签参数:</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-153e800fcee67e3b.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　最后还需要配置一下git仓库地址,注意需要修改拉取的版本的变量为 $git_version</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-d887d7dad72788ed.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　此时点击项目的build with parameters就会看到对应的版本号：</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-80a89d94d1158457.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　然后去jenkins工作目录下查看是否拉取了对应版本:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span>/<span style=color:#66d9ef>var</span>/lib/jenkins/workspace/my-deploy-rollback
</span></span></code></pre></div><h2 id=4优化部署脚本>4.优化部署脚本
<a class=header-anchor href=#4%e4%bc%98%e5%8c%96%e9%83%a8%e7%bd%b2%e8%84%9a%e6%9c%ac></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cat &gt;/scripts/jenkins/deploy_rollback.sh<span style=color:#e6db74>&lt;&lt;&#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>PATH_CODE=/var/lib/jenkins/workspace/my-deploy-rollback/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>PATH_WEB=/usr/share/nginx
</span></span></span><span style=display:flex><span><span style=color:#e6db74>IP=10.0.0.7
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#打包代码
</span></span></span><span style=display:flex><span><span style=color:#e6db74>cd ${PATH_CODE} 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tar zcf /opt/web-${git_version}.tar.gz ./*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#拷贝打包好的代码发送到web服务器代码目录
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ssh ${IP} &#34;mkdir ${PATH_WEB}/web-${git_version} -p&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>scp /opt/web-${git_version}.tar.gz ${IP}:${PATH_WEB}/web-${git_version}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#web服务器解压代码
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ssh ${IP} &#34;cd ${PATH_WEB}/web-${git_version} &amp;&amp; tar xf web-${git_version}.tar.gz &amp;&amp; rm -rf web-${git_version}.tar.gz&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ssh ${IP} &#34;cd ${PATH_WEB} &amp;&amp; rm -rf html &amp;&amp; ln -s web-${git_version} html&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h2 id=5jenkins添加执行脚本动作并测试>5.jenkins添加执行脚本动作并测试
<a class=header-anchor href=#5jenkins%e6%b7%bb%e5%8a%a0%e6%89%a7%e8%a1%8c%e8%84%9a%e6%9c%ac%e5%8a%a8%e4%bd%9c%e5%b9%b6%e6%b5%8b%e8%af%95></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-550d6e21c5836a80.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=6测试发布>6.测试发布
<a class=header-anchor href=#6%e6%b5%8b%e8%af%95%e5%8f%91%e5%b8%83></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-179825d3e082e54c.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　然后去web服务器上查看发现已经发布了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[root@web-7 ~]</span><span style=color:#960050;background-color:#1e0010>#</span> ll /usr/share/nginx/
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>总用量</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>15</span>:<span style=color:#ae81ff>59</span> html -&gt; web-v2.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>15</span>:<span style=color:#ae81ff>59</span> web-v2.<span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h1 id=第7章-tag方式回滚版本>第7章 tag方式回滚版本
<a class=header-anchor href=#%e7%ac%ac7%e7%ab%a0-tag%e6%96%b9%e5%bc%8f%e5%9b%9e%e6%bb%9a%e7%89%88%e6%9c%ac></a></h1><h2 id=1jenkins配置回滚选项参数>1.jenkins配置回滚选项参数
<a class=header-anchor href=#1jenkins%e9%85%8d%e7%bd%ae%e5%9b%9e%e6%bb%9a%e9%80%89%e9%a1%b9%e5%8f%82%e6%95%b0></a></h2><p>　　在工程配置里添加选项参数:</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-cb57cd24349fb385.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　在参数化构建里添加2个选项：发布和回滚</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-635aa525f63635c8.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　此时查看构建页面就会发现多了选项卡:</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-8dbc88c910f9aec2.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=2修改发布脚本增加条件判断>2.修改发布脚本增加条件判断
<a class=header-anchor href=#2%e4%bf%ae%e6%94%b9%e5%8f%91%e5%b8%83%e8%84%9a%e6%9c%ac%e5%a2%9e%e5%8a%a0%e6%9d%a1%e4%bb%b6%e5%88%a4%e6%96%ad></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cat &gt;/scripts/jenkins/deploy_rollback.sh <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>PATH_CODE=/var/lib/jenkins/workspace/my-deploy-rollback/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>PATH_WEB=/usr/share/nginx
</span></span></span><span style=display:flex><span><span style=color:#e6db74>IP=10.0.0.7
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#打包代码
</span></span></span><span style=display:flex><span><span style=color:#e6db74>code_tar(){
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        cd ${PATH_CODE} 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        tar zcf /opt/web-${git_version}.tar.gz ./*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#拷贝打包好的代码发送到web服务器代码目录
</span></span></span><span style=display:flex><span><span style=color:#e6db74>code_scp(){
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ssh ${IP} &#34;mkdir ${PATH_WEB}/web-${git_version} -p&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        scp /opt/web-${git_version}.tar.gz ${IP}:${PATH_WEB}/web-${git_version}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#web服务器解压代码
</span></span></span><span style=display:flex><span><span style=color:#e6db74>code_xf(){
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ssh ${IP} &#34;cd ${PATH_WEB}/web-${git_version} &amp;&amp; tar xf web-${git_version}.tar.gz &amp;&amp; rm -rf web-${git_version}.tar.gz&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#创建代码软链接
</span></span></span><span style=display:flex><span><span style=color:#e6db74>code_ln(){
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ssh ${IP} &#34;cd ${PATH_WEB} &amp;&amp; rm -rf html &amp;&amp; ln -s web-${git_version} html&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>main(){
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        code_tar
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        code_scp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        code_xf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        code_ln
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#选择发布还是回滚
</span></span></span><span style=display:flex><span><span style=color:#e6db74>if [ &#34;${deploy_env}&#34; == &#34;deploy&#34; ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ssh ${IP} &#34;ls ${PATH_WEB}/web-${git_version}&#34; &gt;/dev/null 2&gt;&amp;1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if [ $? == 0 -a ${GIT_COMMIT} == ${GIT_PREVIOUS_SUCCESSFUL_COMMIT} ] 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                echo &#34;web-${git_version} 已部署,不允许重复构建&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                exit
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        else 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                main
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>elif [ &#34;${deploy_env}&#34; == &#34;rollback&#34; ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        code_ln
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h2 id=3测试回滚功能>3.测试回滚功能
<a class=header-anchor href=#3%e6%b5%8b%e8%af%95%e5%9b%9e%e6%bb%9a%e5%8a%9f%e8%83%bd></a></h2><p>　　部署v1.0版本</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-0fb97bee362054f6.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　部署v2.0版本：</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-7556f99c43166f34.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1190/format/webp alt>​</p><p>　　检查web服务器当前的版本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[root@web-7 ~]</span><span style=color:#960050;background-color:#1e0010>#</span> ll /usr/share/nginx/
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>总用量</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>52</span> html -&gt; web-v2.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>51</span> web-v1.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>52</span> web-v2.<span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>　　然后我们选择v1.0版本并且选择回滚操作：</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-6087d515bd66d430.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　查看控制台显示回滚成功：</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-19a944d32ff5572e.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　在web服务器上查看发现已经回滚成功：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[root@web-7 ~]</span><span style=color:#960050;background-color:#1e0010>#</span> ll /usr/share/nginx/
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>总用量</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>56</span> html -&gt; web-v1.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>51</span> web-v1.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>52</span> web-v2.<span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h2 id=4发布新代码并打标签测试>4.发布新代码并打标签测试
<a class=header-anchor href=#4%e5%8f%91%e5%b8%83%e6%96%b0%e4%bb%a3%e7%a0%81%e5%b9%b6%e6%89%93%e6%a0%87%e7%ad%be%e6%b5%8b%e8%af%95></a></h2><p>　　修改代码并发布v3.0:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cd h5game/
</span></span><span style=display:flex><span>echo v3.0 &gt;&gt; index.html
</span></span><span style=display:flex><span>git commit -am <span style=color:#e6db74>&#39;v3.0&#39;</span>
</span></span><span style=display:flex><span>git tag -a v3.0 -m <span style=color:#e6db74>&#39;v3.0 稳定版&#39;</span>   
</span></span><span style=display:flex><span>git push -u origin v3.0
</span></span><span style=display:flex><span>git tag
</span></span></code></pre></div><p>　　jenkins查看并发布3.0版本:</p><p>　　[图片上传失败&mldr;(image-a1e6e7-1598955937011)]</p><p>　　web服务器查看发布情况：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[root@web-7 ~]</span><span style=color:#960050;background-color:#1e0010>#</span> ll /usr/share/nginx/
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>总用量</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>58</span> html -&gt; web-v3.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>51</span> web-v1.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>52</span> web-v2.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>58</span> web-v3.<span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>　　然后工程选择回滚到v2.0版本:</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-cb002e65ff2e61ff.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　再次在web服务器上查看:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[root@web-7 ~]</span><span style=color:#960050;background-color:#1e0010>#</span> ll /usr/share/nginx/
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>总用量</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>59</span> html -&gt; web-v2.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>51</span> web-v1.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>52</span> web-v2.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>月</span>   <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>58</span> web-v3.<span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h1 id=第8章-打标签工程>第8章 打标签工程
<a class=header-anchor href=#%e7%ac%ac8%e7%ab%a0-%e6%89%93%e6%a0%87%e7%ad%be%e5%b7%a5%e7%a8%8b></a></h1><h2 id=1jenkins新建打标签工程>1.jenkins新建打标签工程
<a class=header-anchor href=#1jenkins%e6%96%b0%e5%bb%ba%e6%89%93%e6%a0%87%e7%ad%be%e5%b7%a5%e7%a8%8b></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-d6949b9013bd7998.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1062/format/webp alt>​</p><h2 id=2配置参数化构建>2.配置参数化构建
<a class=header-anchor href=#2%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0%e5%8c%96%e6%9e%84%e5%bb%ba></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-563b942422e1c2fd.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=3配置工程的源码管理>3.配置工程的源码管理
<a class=header-anchor href=#3%e9%85%8d%e7%bd%ae%e5%b7%a5%e7%a8%8b%e7%9a%84%e6%ba%90%e7%a0%81%e7%ae%a1%e7%90%86></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-fbd3e7309543f7c0.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><h2 id=4配置构建动作>4.配置构建动作
<a class=header-anchor href=#4%e9%85%8d%e7%bd%ae%e6%9e%84%e5%bb%ba%e5%8a%a8%e4%bd%9c></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-8b4a07f3c0a49694.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　配置命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>git tag -a $git_newversion -m <span style=color:#e6db74>&#34;</span>$git_newversion<span style=color:#e6db74> 稳定版&#34;</span>
</span></span><span style=display:flex><span>git push -u origin $git_newversion
</span></span></code></pre></div><h2 id=5发布新版本并提交到master>5.发布新版本并提交到master
<a class=header-anchor href=#5%e5%8f%91%e5%b8%83%e6%96%b0%e7%89%88%e6%9c%ac%e5%b9%b6%e6%8f%90%e4%ba%a4%e5%88%b0master></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>echo</span> <span style=color:#e6db74>&#34;v4.0&#34;</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#f92672>index</span>.<span style=color:#a6e22e>html</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>git</span> <span style=color:#f92672>add</span> <span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>git</span> <span style=color:#f92672>commit</span> <span style=color:#f92672>-m</span> <span style=color:#e6db74>&#34;v4.0 稳定版&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>git</span> <span style=color:#f92672>push</span> <span style=color:#f92672>-u</span> <span style=color:#f92672>origin</span> <span style=color:#f92672>v4</span>.<span style=color:#a6e22e>0</span>
</span></span></code></pre></div><h2 id=6jenkins使用打标签工程来打标签>6.jenkins使用打标签工程来打标签
<a class=header-anchor href=#6jenkins%e4%bd%bf%e7%94%a8%e6%89%93%e6%a0%87%e7%ad%be%e5%b7%a5%e7%a8%8b%e6%9d%a5%e6%89%93%e6%a0%87%e7%ad%be></a></h2><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-f8493f594917ebab.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1092/format/webp alt>​</p><p>　　查看控制台输出发现提示没有权限:</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-a2171db53067508e.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　我们需要在gitlab上把deploy key设置允许写入</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-6c2a9f469057641b.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1200/format/webp alt>​</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-55ed2349bc13109d.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1152/format/webp alt>​</p><p>　　然后重新构建</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback></code></pre></div><p>　　返回到deploy-rollback工程查看可以发现已经生成了新标签，然后我们开始构建：</p><p>　　​<img src=/imgs/img-lazy-loading.gif data-src=//upload-images.jianshu.io/upload_images/14248468-569a33f00f8aa90e.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1008/format/webp alt>​</p><p>　　在web服务器上查看可以发现新版本已经发布成功了：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[root@web ~]</span><span style=color:#960050;background-color:#1e0010>#</span> ll /usr/share/nginx/
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>总用量</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root    <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>月</span>  <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>09</span> html -&gt; web-v4.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>8</span> root root <span style=color:#ae81ff>4096</span> <span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>月</span>  <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>05</span> web-
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>8</span> root root <span style=color:#ae81ff>4096</span> <span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>月</span>  <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>15</span>:<span style=color:#ae81ff>00</span> web-v1.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>8</span> root root <span style=color:#ae81ff>4096</span> <span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>月</span>  <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>15</span>:<span style=color:#ae81ff>00</span> web-v2.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>8</span> root root <span style=color:#ae81ff>4096</span> <span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>月</span>  <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>15</span>:<span style=color:#ae81ff>37</span> web-v3.<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>8</span> root root <span style=color:#ae81ff>4096</span> <span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>月</span>  <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>09</span> web-v4.<span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>　　作者：被运维耽误的厨子<br>链接：https://www.jianshu.com/p/a9d607ec3a05<br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/%e8%bf%90%e7%bb%b4>运维
</a><a href=/tags/linux>Linux
</a><a href=/tags/jenkins>Jenkins</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/content/ali-pay.jpg alt="szh - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/content/wechat-pay.jpg alt="szh - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
Jenkins入门</li><li class=post-copyright-author><strong>本文作者： </strong>szh</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://szhiku.github.io/post/jenkins-entry-z2edmed.html title=Jenkins入门>https://szhiku.github.io/post/jenkins-entry-z2edmed.html</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/kubernetes-supports-swap-but-cgroup-v2-zaivgs.html rel=next title="kubernetes支持swap了，但是cgroup v2"><i class="fa fa-chevron-left"></i> kubernetes支持swap了，但是cgroup v2</a></div><div class="post-nav-prev post-nav-item"><a href=/post/redis-fast-entry-2ltiy1.html rel=prev title=Redis快速入门>Redis快速入门
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>szh</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.145.0 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://webify.cloudbase.net title=Webify>Webify
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script><script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#87CEEB","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://szhiku.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o \n\n可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄\n(Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.b0c78e5a4df586ee46d02716ffa91a4a322e56763e04e91eb2ba052c9469ed02.js defer></script></body></html>